#
# Minimal Sphinx configuration sample (clean, simple, functional)
#

indexer
{
	mem_limit		= 32M
}


searchd
{
    listen          = 127.0.0.1:9312
    log             = /Users/denisboldinov/Sites/zapad.dev/protected/runtime/searchd.log
    query_log       = /Users/denisboldinov/Sites/zapad.dev/protected/runtime/searchd.query.log
    pid_file        = /Users/denisboldinov/Sites/zapad.dev/protected/runtime/searchd.development.pid
    binlog_path     = /Users/denisboldinov/Sites/zapad.dev/protected/runtime/
	read_timeout	= 5
	max_children	= 30
	max_matches		= 2000
	seamless_rotate = 1
	preopen_indexes = 1
	unlink_old		= 1
	workers			= threads # for RT to work
}


source apartment_core_0
{
	type          = mysql
    sql_host      = localhost
    sql_user      = root
    sql_pass      =
    sql_db        = zapad
    sql_query_pre = SET NAMES utf8
    sql_query = SELECT a.`id`, a.`address`, a.`name` as title, c.`name` as city, ar.`name` as area, CONCAT ('Ð¼. ', ms.`name`) as metro, \
                GROUP_CONCAT(CONCAT(attr.`name`,' ', aa.`value`)  SEPARATOR ' ') AS attributes FROM apartment a \
                LEFT JOIN `apartment_attribute` aa ON a.`id` = aa.`apartment_id` \
                LEFT JOIN `attribute` attr ON aa.`attribute_id` = attr.`id` \
                LEFT JOIN `city` c ON a.`city_id` = c.`id` \
                LEFT JOIN `area` ar ON a.`area_id` = ar.`id` \
                LEFT JOIN `metro_station` ms ON a.`metro_id` = ms.`id` \
                GROUP BY a.`id`
	sql_query_info		= SELECT * FROM apartment WHERE id=$id
}

index apartment_core
{
  source = apartment_core_0
  path = /Users/denisboldinov/Sites/zapad.dev/protected/data/Apartment
  charset_type = utf-8
}

index apartment
{
  type = distributed
  local = apartment_core
}
